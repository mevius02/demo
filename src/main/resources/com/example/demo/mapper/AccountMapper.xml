<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.mapper.AccountMapper">

  <select id="selectMyAccount" parameterType="String" resultType="com.example.demo.model.Account">
    SELECT 
      muser.update_cnt AS user_update_cnt
      , muser.user_id
      , turole.role_cd
      , mrole.role_nm
      , muser.user_nm
      , muser.account_expiration
      , muser.password_expiration
      , muser.enabled
      , muser.insert_user_id AS user_insert_user_id
      , muser.insert_timestamp AS user_insert_timestamp
      , muser.update_user_id AS user_update_user_id
      , muser.update_timestamp AS user_update_timestamp
      , mudetail.update_cnt AS detail_update_cnt
      , mudetail.last_nm
      , mudetail.first_nm
      , mudetail.last_nm_kana
      , mudetail.first_nm_kana
      , mudetail.gender
      , mudetail.phone_no
      , mudetail.mobile_phone_no
      , mudetail.mail_address
      , mudetail.post_no
      , mudetail.prefecture
      , mudetail.address
      , mudetail.address_kana
      , mudetail.date_of_birth
      , DATE_PART('YEAR', AGE(mudetail.date_of_birth)) AS age
      , mudetail.blood_type
      , mudetail.system_thema_cd
      , msthema.system_thema_nm
      , mudetail.insert_user_id AS detail_insert_user_id
      , mudetail.insert_timestamp AS detail_insert_timestamp
      , mudetail.update_user_id AS detail_update_user_id
      , mudetail.update_timestamp AS detail_update_timestamp
    FROM 
      public.m_user muser
      INNER JOIN public.m_user_detail mudetail ON (
        muser.user_id = mudetail.user_id
      )
      INNER JOIN public.t_user_role turole ON (
        muser.user_id = turole.user_id
      )
      INNER JOIN public.m_role mrole ON (
        turole.role_cd = mrole.role_cd
      )
      LEFT JOIN public.m_system_thema msthema ON (
        mudetail.system_thema_cd = msthema.system_thema_cd
      )
    <where>
      <if test="userId != null">
        AND muser.user_id = #{userId}
      </if>
    </where>
  </select>

  <!-- <update id="updateMyAccount" parameterType="com.example.demo.model.mybatis.MUser">
    UPDATE public.m_user
    <set>
      <if test="password != null">
        password = #{password, jdbcType=VARCHAR},
      </if>
      user_nm = #{userNm, jdbcType=VARCHAR},
      mail_address = #{mailAddress, jdbcType=VARCHAR},
      system_thema_cd = #{systemThemaCd, jdbcType=VARCHAR},
      update_user_id = #{updateUserId, jdbcType=VARCHAR},
      update_timestamp = #{updateTimestamp, jdbcType=TIMESTAMP},
    </set>
    <where>
      AND user_id = #{userId, jdbcType=VARCHAR}
    </where>
  </update> -->

</mapper>